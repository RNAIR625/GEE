{% extends "base.html" %}

{% block title %}Function Management{% endblock %}

{% block additional_styles %}
.table thead th {
    background-color: #4dabf7;
    color: white;
    font-weight: 500;
}

.function-card {
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
    height: 100%;
}

.function-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.function-icon {
    font-size: 2rem;
    color: #4dabf7;
    opacity: 0.7;
    margin-bottom: 1rem;
}

.parameter-section {
    margin-top: 30px;
    border-top: 1px solid #dee2e6;
    padding-top: 20px;
}

.parameter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.parameter-card {
    border-left: 4px solid #4dabf7;
    transition: all 0.2s ease;
}

.parameter-card:hover {
    background-color: #f8f9fa;
}

.param-type-badge {
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
    border-radius: 10px;
    font-weight: 600;
}

.selected-function {
    background-color: rgba(77, 171, 247, 0.1);
    border-left: 3px solid #4dabf7;
}

.function-summary {
    background-color: #f8f9fa;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.function-detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #dee2e6;
}

.function-detail-label {
    font-size: 0.75rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.sequence-number {
    display: inline-block;
    width: 24px;
    height: 24px;
    line-height: 24px;
    text-align: center;
    border-radius: 50%;
    background-color: rgba(77, 171, 247, 0.1);
    color: #4dabf7;
    font-weight: bold;
    margin-right: 0.5rem;
}

.drag-handle {
    cursor: move;
    color: #adb5bd;
}

.function-item {
    transition: all 0.2s ease;
}

.function-item:hover {
    background-color: rgba(77, 171, 247, 0.05);
}

.function-actions {
    visibility: hidden;
    opacity: 0;
    transition: all 0.2s ease;
}

.function-item:hover .function-actions {
    visibility: visible;
    opacity: 1;
}

.no-functions-placeholder {
    text-align: center;
    padding: 3rem 1rem;
    background-color: #f8f9fa;
    border-radius: 6px;
}

.parameter-list-empty {
    text-align: center;
    padding: 2rem;
    background-color: #f8f9fa;
    border-radius: 6px;
    color: #6c757d;
}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Functions Overview -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm function-summary">
                <div class="card-body">
                    <h4 class="card-title mb-3">Functions Management</h4>
                    <p class="text-muted">Define and manage function definitions and their parameters. Functions can be used in rules and data processing operations.</p>
                    <div class="d-flex align-items-center mt-3">
                        <div class="me-4">
                            <div class="function-detail-label">Total Functions</div>
                            <h3 id="functionCount" class="mb-0">0</h3>
                        </div>
                        <div class="me-4">
                            <div class="function-detail-label">Parameters</div>
                            <h3 id="parameterCount" class="mb-0">0</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Quick Actions</h5>
                    <p class="text-muted">Create and manage function definitions</p>
                    <button class="btn btn-primary mt-auto" onclick="openNewFunctionModal()">
                        <i class="fas fa-plus me-2"></i>New Function
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Functions Table and Parameters Section -->
    <div class="row">
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">All Functions</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive function-table">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Function Name</th>
                                    <th>Parameters</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="functionTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm" id="parameterSection">
                <div class="card-header bg-white">
                    <div class="parameter-header">
                        <h5 class="mb-0">Parameters for: <span id="selectedFunctionName" class="text-primary">No function selected</span></h5>
                        <button class="btn btn-primary btn-sm" id="addParameterBtn" onclick="openNewParamModal()" disabled>
                            <i class="fas fa-plus me-2"></i>Add Parameter
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="noParametersPlaceholder" class="parameter-list-empty">
                        <i class="fas fa-info-circle mb-3" style="font-size: 2rem; color: #adb5bd;"></i>
                        <h5>No Function Selected</h5>
                        <p>Select a function from the list to view and manage its parameters.</p>
                    </div>
                    
                    <div id="parametersContainer">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead>
                                    <tr>
                                        <th>Seq.</th>
                                        <th>Parameter Name</th>
                                        <th>Type</th>
                                        <th>I/O Type</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="parameterTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>
{% endblock %}

{% block modals %}
<!-- Function Modal -->
<div class="modal fade" id="functionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="functionModalTitle">Add New Function</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="functionForm">
                    <input type="hidden" id="gbfId">
                    <div class="mb-3">
                        <label class="form-label">Function Name</label>
                        <input type="text" class="form-control" id="funcName" required>
                        <div class="form-text">Use a descriptive name that indicates the function's purpose</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="funcDescription" rows="3"></textarea>
                        <div class="form-text">Explain what this function does and how it should be used</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveFunction()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Parameter Modal -->
<div class="modal fade" id="parameterModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="parameterModalTitle">Add New Parameter</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="parameterForm">
                    <input type="hidden" id="gbfpId">
                    <input type="hidden" id="paramFunctionId">
                    
                    <div class="mb-3">
                        <label class="form-label">Parameter Name</label>
                        <input type="text" class="form-control" id="paramName" required>
                        <div class="form-text">Use a clear, descriptive name for this parameter</div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Data Type</label>
                            <select class="form-control" id="paramType" required>
                                <option value="VARCHAR">VARCHAR</option>
                                <option value="INTEGER">INTEGER</option>
                                <option value="DECIMAL">DECIMAL</option>
                                <option value="DATE">DATE</option>
                                <option value="DATETIME">DATETIME</option>
                                <option value="BOOLEAN">BOOLEAN</option>
                            </select>
                            <div class="form-text">The data type determines what values can be passed</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">I/O Type</label>
                            <select class="form-control" id="paramIOType" required>
                                <option value="INPUT">INPUT</option>
                                <option value="OUTPUT">OUTPUT</option>
                            </select>
                            <div class="form-text">Whether this is an input or output parameter</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Sequence</label>
                            <input type="number" class="form-control" id="paramSequence" min="1" value="1" required>
                            <div class="form-text">Order in which parameters appear</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="paramDescription" rows="3"></textarea>
                        <div class="form-text">Explain what this parameter is used for</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveParameter()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalTitle">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="deleteModalBody">
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<!-- Function management script -->
<script src="{{ url_for('static', filename='js/function.js') }}"></script>
{% endblock %}
